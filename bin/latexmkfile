#!/usr/bin/env ruby
#
# latexmkfile
#   Creates a simple makefile for XeLaTeX.
#   Also touches the source file if it doesn't already exist.
#
# Usage: latexmkfile filename
#
# Exmplae: latexmkfile trees

require 'fileutils'

MAKEFILE_TEMPLATE = <<-eos
preview: _.pdf
\topen _.pdf

_.pdf: _.tex
\txelatex _.tex
eos

file = 'makefile'
name = ARGV[0]
tex = "#{name}.tex"

if name.nil?
  puts 'Usage: latexmkfile filename'
  exit
end

if File.exists?(file)
  puts 'Makefile already exists. Not overriding. '
  exit
end

File.write(file, MAKEFILE_TEMPLATE.gsub('_', name))
puts 'Makefile written. '

if !File.exists?(tex)
  FileUtils.touch(tex)
  puts 'LaTeX source file touched. '
end